# This file is sourced by zsh for all shells.
# It cannot affect any input or output, and shouldn't assume that it's connected
# to a TTY.


# Load our basic environment.
if [ -f ~/.env ] && [ -r ~/.env ]
then
  . ~/.env
fi



# Create local TeX directories.
mkdir -p "${HOME}/"texmf >/dev/null 2>&1


# Environment variables.

QT_SELECT=5
export QT_SELECT


# Use vim as the default editor.
if command -v vim >/dev/null 2>&1
then
  export EDITOR="$(which vim)"
fi

# Use color in less.
export LESSCOLOR="yes"

# Connect to system qemu libvirtd by default.
export LIBVIRT_DEFAULT_URI="qemu:///system"

# The interactive Python startup file.
export PYTHONSTARTUP="${HOME}/.pythonrc.py"

# Use st as the terminal.
if command -v st >/dev/null 2>&1
then
  export TERMINAL="st"
fi

# Local TeX packages.
export TEXMFHOME="${HOME}/texmf"


# Set the PATH-like variables.


# Tie arrays to the PATH-like, colon-separated variables.
typeset -T CLASSPATH classpath
typeset -T GEM_PATH gem_path
typeset -T GOPATH gopath
typeset -T LS_COLORS ls_colors

# Note that PATH and MANPATH already have tied arrays by default.


# Set the CLASSPATH.


if [ -e "/usr/share/junit/lib/junit.jar" ]
then
  classpath+=("/usr/share/junit/lib/junit.jar")
fi


# Set the GOPATH.


gopath=("${HOME}/.local/go")


# Set the LS_COLORS.


ls_colors+=("*.green=04;32")


# Set the PATH.


# Go binaries.
path=("${HOME}/.local/go/bin" "$path[@]")


# Add any ruby gems to the PATH.
if command -v ruby >/dev/null 2>&1
then
  GEM_PATH="$(unset GEM_PATH; unset GEM_HOME; gem env gempath)${GEM_PATH:+:${GEM_PATH}}"
  export GEM_HOME="$(ruby -e 'print Gem.user_dir')"
  gem_path+=("${GEM_HOME}")
  path=("$(ruby -e 'print Gem.bindir')" "$path[@]")
fi

# Add general system directories (just in case).
for d in /usr/local/bin /usr/bin /bin /usr/local/sbin /usr/sbin /sbin
do
  path+=("$d")
done

# FSlint utilities.
if [ -d "/usr/share/fslint/fslint" ]
then
  path+=("/usr/share/fslint/fslint")
fi

# Ccache
if [ -d "/usr/lib/ccache/bin" ]
then
  path=("/usr/lib/ccache/bin" "$path[@]")
fi




# TeX Live perl stuff.

if [ -d "/usr/share/tlpkg" ]
then
  perl5lib=("/usr/share/tlpkg" "$perl5lib[@]")
fi

if [ -d "/usr/share/texmf-dist/scripts/texlive" ]
then
  perl5lib=("/usr/share/texmf-dist/scripts/texlive" "$perl5lib[@]")
fi




# Force the variables tied to arrays to have unique elements.
typeset -U classpath
typeset -U gem_path
typeset -U gopath
typeset -U ls_colors
typeset -U path

export GEM_PATH

# CCache location
if [ -d "/var/cache/ccache/${USER}" ]
then
  export CCACHE_DIR="/var/cache/ccache/${USER}"
fi
export USE_CCACHE=1
export ANDROID_JACK_VM_ARGS="-Dfile.encoding=UTF-8 -XX:+TieredCompilation -Xmx4G"

export R_LIBS_USER="${HOME}/.rlibs/x86_64-pc-linux-gnu-library/3.4"



# Read our modular config.
if [ -d ~/.zshenv.d ]
then
  for file in ~/.zshenv.d/*
  do
    [ -f "$file" ] && [ -r "$file" ] && . "$file"
  done
fi
unset file

# Read local overrides.
if [ -f ~/.zshenv.local ] && [ -r ~/.zshenv.local ]
then
  . ~/.zshenv.local
fi
